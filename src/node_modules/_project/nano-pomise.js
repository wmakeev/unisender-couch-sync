const promisify = require('es6-promisify')
const nano = require('nano')

function promisifyMethods (obj, methods) {
  return methods.reduce((res, method) => {
    res[method] = promisify(obj[method], obj)
    return res
  }, {})
}

/**
 * Promise wrapper for `nano`
 * @param {string} host url to DB
 * @returns {Object} methods
 */
module.exports = function nanoPromise (host) {
  let couch = nano(host)

  return {
    /** database functions */
    db: {
      /** Creates a scope where you operate inside `name`
       * @param {string} name db name
       * @returns {Object} methods
       */
      use (name) {
        let db = couch.db.use(name)
        return promisifyMethods(db, ['insert', 'get', 'bulk', 'fetch', 'fetchRevs', 'view'])
      }
    }
  }
}
